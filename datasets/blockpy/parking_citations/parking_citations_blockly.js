

var parking_citations_INDEXES = [
    ["(None)", "(None)"],
    
    ["Data.Fine", "Data.Fine"] 
];

var parking_citations_INDEX_VALUES = {
    "(None)": [],
    
    "Data.Fine": [
        
        ["-155.0", "-155.0"] ,
        ["-110.0", "-110.0"] ,
        ["-75.0", "-75.0"] ,
        ["-50.0", "-50.0"] ,
        ["-35.0", "-35.0"] ,
        ["-30.0", "-30.0"] ,
        ["-25.0", "-25.0"] ,
        ["-15.0", "-15.0"] ,
        ["-10.0", "-10.0"] ,
        ["-5.0", "-5.0"] ,
        ["-3.0", "-3.0"] ,
        ["-2.95", "-2.95"] ,
        ["-2.0", "-2.0"] ,
        ["-0.01", "-0.01"] ,
        ["0.0", "0.0"] ,
        ["0.5", "0.5"] ,
        ["0.56", "0.56"] ,
        ["2.91", "2.91"] ,
        ["3.0", "3.0"] ,
        ["3.95", "3.95"] ,
        ["4.0", "4.0"] ,
        ["4.5", "4.5"] ,
        ["6.28", "6.28"] ,
        ["7.97", "7.97"] ,
        ["9.0", "9.0"] ,
        ["10.94", "10.94"] ,
        ["13.0", "13.0"] ,
        ["13.54", "13.54"] ,
        ["13.68", "13.68"] ,
        ["13.81", "13.81"] ,
        ["13.96", "13.96"] ,
        ["14.07", "14.07"] ,
        ["16.0", "16.0"] ,
        ["19.0", "19.0"] ,
        ["20.0", "20.0"] ,
        ["21.17", "21.17"] ,
        ["22.0", "22.0"] ,
        ["24.95", "24.95"] ,
        ["25.0", "25.0"] ,
        ["26.5", "26.5"] ,
        ["27.81", "27.81"] ,
        ["28.0", "28.0"] ,
        ["28.7", "28.7"] ,
        ["29.0", "29.0"] ,
        ["29.5", "29.5"] ,
        ["30.0", "30.0"] ,
        ["31.0", "31.0"] ,
        ["32.0", "32.0"] ,
        ["32.5", "32.5"] ,
        ["32.99", "32.99"] ,
        ["33.0", "33.0"] ,
        ["33.41", "33.41"] ,
        ["34.0", "34.0"] ,
        ["34.27", "34.27"] ,
        ["34.36", "34.36"] ,
        ["35.0", "35.0"] ,
        ["35.5", "35.5"] ,
        ["37.0", "37.0"] ,
        ["37.28", "37.28"] ,
        ["38.0", "38.0"] ,
        ["39.75", "39.75"] ,
        ["40.0", "40.0"] ,
        ["42.0", "42.0"] ,
        ["42.64", "42.64"] ,
        ["42.87", "42.87"] ,
        ["44.7", "44.7"] ,
        ["45.0", "45.0"] ,
        ["46.16", "46.16"] ,
        ["46.67", "46.67"] ,
        ["46.94", "46.94"] ,
        ["47.0", "47.0"] ,
        ["50.0", "50.0"] ,
        ["51.5", "51.5"] ,
        ["51.64", "51.64"] ,
        ["53.0", "53.0"] ,
        ["55.0", "55.0"] ,
        ["56.0", "56.0"] ,
        ["57.47", "57.47"] ,
        ["57.5", "57.5"] ,
        ["57.56", "57.56"] ,
        ["58.03", "58.03"] ,
        ["58.1", "58.1"] ,
        ["58.93", "58.93"] ,
        ["59.0", "59.0"] ,
        ["60.0", "60.0"] ,
        ["60.5", "60.5"] ,
        ["62.77", "62.77"] ,
        ["63.0", "63.0"] ,
        ["63.19", "63.19"] ,
        ["63.66", "63.66"] ,
        ["63.75", "63.75"] ,
        ["64.0", "64.0"] ,
        ["64.04", "64.04"] ,
        ["64.95", "64.95"] ,
        ["65.0", "65.0"] ,
        ["67.1", "67.1"] ,
        ["67.77", "67.77"] ,
        ["68.02", "68.02"] ,
        ["68.2", "68.2"] ,
        ["69.6", "69.6"] ,
        ["70.0", "70.0"] ,
        ["71.36", "71.36"] ,
        ["73.0", "73.0"] ,
        ["73.78", "73.78"] ,
        ["75.0", "75.0"] ,
        ["75.3", "75.3"] ,
        ["75.37", "75.37"] ,
        ["76.0", "76.0"] ,
        ["76.5", "76.5"] ,
        ["77.0", "77.0"] ,
        ["77.46", "77.46"] ,
        ["78.0", "78.0"] ,
        ["78.44", "78.44"] ,
        ["79.5", "79.5"] ,
        ["80.0", "80.0"] ,
        ["80.1", "80.1"] ,
        ["81.0", "81.0"] ,
        ["81.78", "81.78"] ,
        ["82.0", "82.0"] ,
        ["82.5", "82.5"] ,
        ["82.7", "82.7"] ,
        ["83.0", "83.0"] ,
        ["83.22", "83.22"] ,
        ["84.08", "84.08"] ,
        ["85.0", "85.0"] ,
        ["85.81", "85.81"] ,
        ["86.0", "86.0"] ,
        ["86.24", "86.24"] ,
        ["88.0", "88.0"] ,
        ["88.33", "88.33"] ,
        ["88.87", "88.87"] ,
        ["89.0", "89.0"] ,
        ["89.91", "89.91"] ,
        ["90.0", "90.0"] ,
        ["90.33", "90.33"] ,
        ["91.0", "91.0"] ,
        ["91.11", "91.11"] ,
        ["92.0", "92.0"] ,
        ["92.2", "92.2"] ,
        ["92.42", "92.42"] ,
        ["93.95", "93.95"] ,
        ["94.0", "94.0"] ,
        ["94.25", "94.25"] ,
        ["95.0", "95.0"] ,
        ["96.0", "96.0"] ,
        ["97.0", "97.0"] ,
        ["97.43", "97.43"] ,
        ["98.0", "98.0"] ,
        ["98.42", "98.42"] ,
        ["99.04", "99.04"] ,
        ["99.32", "99.32"] ,
        ["100.0", "100.0"] ,
        ["101.0", "101.0"] ,
        ["103.0", "103.0"] ,
        ["103.38", "103.38"] ,
        ["104.5", "104.5"] ,
        ["105.0", "105.0"] ,
        ["105.14", "105.14"] ,
        ["105.25", "105.25"] ,
        ["105.3", "105.3"] ,
        ["105.35", "105.35"] ,
        ["106.0", "106.0"] ,
        ["106.77", "106.77"] ,
        ["106.79", "106.79"] ,
        ["107.5", "107.5"] ,
        ["108.0", "108.0"] ,
        ["110.0", "110.0"] ,
        ["110.06", "110.06"] ,
        ["111.0", "111.0"] ,
        ["112.0", "112.0"] ,
        ["112.19", "112.19"] ,
        ["113.0", "113.0"] ,
        ["114.0", "114.0"] ,
        ["114.16", "114.16"] ,
        ["114.93", "114.93"] ,
        ["114.98", "114.98"] ,
        ["115.0", "115.0"] ,
        ["117.73", "117.73"] ,
        ["117.95", "117.95"] ,
        ["118.0", "118.0"] ,
        ["120.0", "120.0"] ,
        ["121.0", "121.0"] ,
        ["121.35", "121.35"] ,
        ["122.0", "122.0"] ,
        ["123.78", "123.78"] ,
        ["125.0", "125.0"] ,
        ["125.56", "125.56"] ,
        ["126.0", "126.0"] ,
        ["126.81", "126.81"] ,
        ["127.0", "127.0"] ,
        ["127.28", "127.28"] ,
        ["127.58", "127.58"] ,
        ["130.0", "130.0"] ,
        ["131.0", "131.0"] ,
        ["131.37", "131.37"] ,
        ["132.0", "132.0"] ,
        ["133.4", "133.4"] ,
        ["133.73", "133.73"] ,
        ["134.0", "134.0"] ,
        ["135.0", "135.0"] ,
        ["135.21", "135.21"] ,
        ["137.0", "137.0"] ,
        ["137.15", "137.15"] ,
        ["137.87", "137.87"] ,
        ["138.26", "138.26"] ,
        ["138.95", "138.95"] ,
        ["139.0", "139.0"] ,
        ["140.0", "140.0"] ,
        ["142.0", "142.0"] ,
        ["144.0", "144.0"] ,
        ["144.26", "144.26"] ,
        ["144.5", "144.5"] ,
        ["145.0", "145.0"] ,
        ["145.92", "145.92"] ,
        ["148.0", "148.0"] ,
        ["148.75", "148.75"] ,
        ["149.33", "149.33"] ,
        ["150.0", "150.0"] ,
        ["155.0", "155.0"] ,
        ["156.18", "156.18"] ,
        ["157.14", "157.14"] ,
        ["160.0", "160.0"] ,
        ["160.12", "160.12"] ,
        ["162.66", "162.66"] ,
        ["164.86", "164.86"] ,
        ["165.0", "165.0"] ,
        ["166.61", "166.61"] ,
        ["167.0", "167.0"] ,
        ["168.85", "168.85"] ,
        ["169.0", "169.0"] ,
        ["170.0", "170.0"] ,
        ["173.18", "173.18"] ,
        ["175.0", "175.0"] ,
        ["175.62", "175.62"] ,
        ["175.69", "175.69"] ,
        ["176.88", "176.88"] ,
        ["178.0", "178.0"] ,
        ["178.72", "178.72"] ,
        ["178.93", "178.93"] ,
        ["179.3", "179.3"] ,
        ["180.0", "180.0"] ,
        ["182.35", "182.35"] ,
        ["184.0", "184.0"] ,
        ["185.0", "185.0"] ,
        ["190.0", "190.0"] ,
        ["192.06", "192.06"] ,
        ["195.0", "195.0"] ,
        ["200.0", "200.0"] ,
        ["201.0", "201.0"] ,
        ["205.0", "205.0"] ,
        ["210.0", "210.0"] ,
        ["215.0", "215.0"] ,
        ["220.0", "220.0"] ,
        ["225.0", "225.0"] ,
        ["232.5", "232.5"] ,
        ["240.0", "240.0"] ,
        ["245.0", "245.0"] ,
        ["250.0", "250.0"] ,
        ["255.0", "255.0"] ,
        ["265.0", "265.0"] ,
        ["275.0", "275.0"] ,
        ["280.0", "280.0"] ,
        ["287.0", "287.0"] ,
        ["290.0", "290.0"] ,
        ["293.0", "293.0"] ,
        ["300.0", "300.0"] ,
        ["305.0", "305.0"] ,
        ["312.0", "312.0"] ,
        ["320.0", "320.0"] ,
        ["324.0", "324.0"] ,
        ["325.0", "325.0"] ,
        ["330.0", "330.0"] ,
        ["350.0", "350.0"] ,
        ["355.0", "355.0"] ,
        ["370.0", "370.0"] ,
        ["375.0", "375.0"] ,
        ["380.0", "380.0"] ,
        ["384.0", "384.0"] ,
        ["390.0", "390.0"] ,
        ["395.0", "395.0"] ,
        ["400.0", "400.0"] ,
        ["415.0", "415.0"] ,
        ["425.0", "425.0"] ,
        ["440.0", "440.0"] 
    ]
}

var parking_citations_PROPERTIES = [
    ["Data.Number Plate", "Data.Number Plate"] ,
    ["Data.State", "Data.State"] ,
    ["Data.Car.Make", "Data.Car.Make"] ,
    ["Data.Car.Style", "Data.Car.Style"] ,
    ["Data.Car.Color", "Data.Car.Color"] ,
    ["Data.Location", "Data.Location"] ,
    ["Data.Violation", "Data.Violation"] ,
    ["Data.Fine", "Data.Fine"] ,
    ["Date.Year", "Date.Year"] ,
    ["Date.Month", "Date.Month"] ,
    ["Date.Day", "Date.Day"] ,
    ["Date.Time.Hour", "Date.Time.Hour"] ,
    ["Date.Time.Minute", "Date.Time.Minute"] 
]

Blockly.Blocks['parking_citations_get'] = {
  init: function() {
    this.setColour(45);
    this.appendDummyInput('MAIN')
        .appendField("parking_citations.get")
        .appendField(new Blockly.FieldDropdown(parking_citations_PROPERTIES), "PROPERTY");
    this.appendDummyInput('SECOND')
        .appendField("filter")
        .appendField(new Blockly.FieldDropdown(parking_citations_INDEXES, function(option) {
                        this.getSourceBlock().updateShape_(option);
                    }), "INDEX")
    this.updateShape_("(None)");
    this.setInputsInline(false);
    this.setOutput(true, "Array");
    this.setTooltip('Returns a list of parking citations data.');
  },
  mutationToDom: function() {
    var container = document.createElement('mutation');
    container.setAttribute('index', this.getFieldValue('INDEX'));
    container.setAttribute('index_value', this.getFieldValue('INDEX_VALUE'));
    container.setAttribute('module', "parking_citations")
    return container;
  },
  domToMutation: function(xmlElement) {
    var index = xmlElement.getAttribute('index');
    this.setFieldValue(index, 'INDEX');
    var index_value = xmlElement.getAttribute('index_value');
    this.updateShape_(index, index_value);
  },
  updateShape_: function(index, index_value) {
    var inputGroup = this.getInput('SECOND')
    var fieldExists = this.getField('INDEX_VALUE');
    if (fieldExists) {
        inputGroup.removeField('INDEX_VALUE');
    }
    try {
        if (index != undefined && index != '(None)') {
            inputGroup.appendField(new Blockly.FieldDropdown(parking_citations_INDEX_VALUES[index]), 'INDEX_VALUE')
            if (index_value != undefined) {
                this.setFieldValue(index_value, 'INDEX_VALUE');
            } else {
                this.setFieldValue(parking_citations_INDEX_VALUES[index][0][0], 'INDEX_VALUE');
            }
        }
    } catch (e) {
        inputGroup.appendField(new Blockly.FieldLabel("Reset to fix the blocks"));
        console.error(e);
    }
  }
};
Blockly.Python['parking_citations_get'] = function(block) {
    Blockly.Python.definitions_['import_parking_citations'] = 'import parking_citations';
    var propertyValue = block.getFieldValue('PROPERTY') || '';
    var property = Blockly.Python.quote_(propertyValue);
    var index_unquoted = block.getFieldValue('INDEX');
    var index = Blockly.Python.quote_(index_unquoted || '');
    var index_value = "''";
    if (index_unquoted !== '(None)') {
        var iv = block.getFieldValue('INDEX_VALUE') || "";
        index_value = Blockly.Python.quote_(iv);
    }
    var code = 'parking_citations.get('+property+',' +index+','+index_value+')';
    return [code, Blockly.Python.ORDER_ATOMIC];
};

BlockMirrorTextToBlocks.prototype.MODULE_FUNCTION_SIGNATURES['parking_citations'] = {
    "get": {
        custom: function(node, parent) {
            if (!node.args || node.args.length < 3 ||
                !node.args[0] || !node.args[1] || !node.args[2] ||
                node.args[0]._astname !== "Str" || node.args[1]._astname !== "Str" || node.args[2]._astname !== "Str"
            ) {
                throw new Error("Not the right function call.");
            }
            return BlockMirrorTextToBlocks.create_block("parking_citations_get", null,
                {"PROPERTY": node.args[0].s.v},
                {}, {}, {"@INDEX": node.args[1].s.v,
                    "@INDEX_VALUE": node.args[2].s.v});
        }
    },
};

BlockMirrorBlockEditor.EXTRA_TOOLS['Data - parking citations'] = '<category name="Data - Parking Citations" colour="45">'+
                    '<block type="parking_citations_get"><mutation index="(None)" index_value=""></mutation></block>'+
                '</category>';